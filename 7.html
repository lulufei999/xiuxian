<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>修仙选择剧情跳转（完整版）</title>
    <style>
        .select-step { margin: 20px 0; }
        .option { padding: 8px 16px; background: #f5f5f5; margin: 5px; cursor: pointer; display: inline-block; border-radius: 4px; }
        .option:hover { background: #e0e0e0; }
        .selected { background: #2196f3; color: white; }
        h3 { color: #333; border-left: 4px solid #2196f3; padding-left: 10px; }

        /* 仙侠背景样式 */
        body { 
            padding: 20px; 
            font-family: "Microsoft YaHei"; 
            background: url('https://picsum.photos/id/1040/1920/1080') no-repeat center center fixed; 
            background-size: cover;
            position: relative;
            margin: 0;
            min-height: 100vh;
        }
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.85); 
            z-index: -1;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 20px rgba(33, 150, 243, 0.5);
        }
        .close-modal {
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #666;
            user-select: none;
        }
        .close-modal:hover {
            color: #ff0000;
        }
        .modal h4 {
            color: #2196f3;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-top: 0;
            font-size: 18px;
        }
        .modal-detail {
            line-height: 1.8;
            color: #333;
            font-size: 15px;
        }

        /* 回退按钮样式 */
        .back-btn {
            margin: 10px 0;
            padding: 8px 16px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-family: "Microsoft YaHei";
        }
        .back-btn:hover {
            background-color: #d32f2f;
        }

        /* 剧情介绍样式 */
        .story-intro {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ff9800;
            line-height: 1.7;
            color: #555;
            font-size: 14px;
        }
        .story-intro h4 {
            margin: 0 0 8px 0;
            color: #ff9800;
            font-size: 16px;
        }

        /* 剧情选择步骤样式 */
        .plot-choice-step {
            margin: 20px 0;
            padding: 15px;
            background-color: rgba(33, 150, 243, 0.1);
            border-radius: 6px;
            display: none;
        }
        .plot-choice-step h3 {
            color: #1976d2;
            border-left-color: #1976d2;
        }
        .plot-option {
            padding: 10px 20px;
            background: #e3f2fd;
            margin: 8px 0;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        .plot-option:hover {
            background: #bbdefb;
            transform: translateX(5px);
        }

        /* 自动跳转提示样式 */
        .jump-tip {
            color: #f44336;
            font-size: 14px;
            margin: 10px 0;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="story-container">
        <!-- 根功法选择 -->
        <div class="select-step" id="root-step">
            <h3>选择根功法</h3>
            <div class="story-intro" id="root-intro">
                <h4>剧情背景</h4>
                <p>你本是青岚宗外门弟子，因偶得上古秘境传承，需从四大至高根功法中择一修行，此选择将决定你一生的修仙轨迹，仙魔两道，一念之间...</p>
            </div>
            <div class="option" data-key="星河令">星河令</div>
            <div class="option" data-key="长生诀">长生诀</div>
            <div class="option" data-key="天魔策">天魔策</div>
            <div class="option" data-key="大荒神陨录">大荒神陨录</div>
        </div>

        <!-- level2流派选择（初始隐藏） -->
        <div class="select-step" id="level2-step" style="display: none;"></div>

        <!-- level3功法选择（初始隐藏） -->
        <div class="select-step" id="level3-step" style="display: none;"></div>

        <!-- level4境界显示（初始隐藏） -->
        <div class="select-step" id="level4-step" style="display: none;"></div>

        <!-- 结局前剧情选择步骤 -->
        <div class="plot-choice-step" id="plot-choice-step">
            <h3>关键剧情抉择（此选择将决定最终结局）</h3>
            <div class="story-intro" id="plot-intro"></div>
            <div id="plot-options"></div>
            <div class="jump-tip" id="jump-tip" style="display: none;">你已做出选择，即将跳转至最终结局...（3秒后自动跳转）</div>
        </div>

        <!-- level5结局选择（初始隐藏） -->
        <div class="select-step" id="level5-step" style="display: none;"></div>
    </div>

    <!-- 结局详情弹窗 -->
    <div class="modal" id="detailModal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h4 id="modalTitle"></h4>
            <div class="modal-detail" id="modalDetail"></div>
        </div>
    </div>

    <script>
        // 完整剧情数据（修复语法错误，所有对象/数组已闭合）
        const storyData = {
            天魔策: {
                level2: [
                    {id: 21, name: "炼体流", desc: "淬炼魔体，以力证道", detail: "炼体流为天魔策核心一脉，以魔气淬炼肉身，让魔体变得坚不可摧，力量无穷，修至大成可炼就不灭魔体，刀枪不入、水火不侵，以绝对力量碾压一切敌人，是最霸道的魔道修行之路。"},
                    {id: 22, name: "噬魂流", desc: "吞噬神魂，以魂证道", detail: "噬魂流为天魔策最阴邪的一脉，吞噬他人神魂，滋养自身魔魂，魔魂越强，修为越高，修至大成可炼就不灭魔魂，随意操控他人神魂，是最诡异的魔道修行之路。"},
                    {id: 23, name: "炼魔流", desc: "炼化魔气，以魔证道", detail: "炼魔流为天魔策本源一脉，炼化天地间的精纯魔气，融入自身，滋养魔体与魔魂，修至大成可炼化亿万魔气，化身为魔主，掌天下魔气，是最正统的魔道修行之路。"}
                ],
                level3: {
                    噬魂流: [
                        {id: 222, name: "噬魂夺舍诀", desc: "吞噬神魂，夺舍肉身", detail: "噬魂夺舍诀为噬魂流核心功法，吞噬他人神魂后可随意夺舍肉身，是噬魂流中最能保命的功法。",
                        level5: [
                            {id: 2221, name: "夺舍仙帝身", desc: "趁仙界仙帝重伤，夺舍其肉身", detail: "你修噬魂夺舍诀大成后，暗中潜伏，趁仙界仙帝渡天劫重伤之际，果断出手吞噬其神魂，夺舍其仙帝肉身，自此鱼目混珠，掌控仙界部分权柄，最终成为双面魔帝，游走于仙魔两界，无人能识。", correspondingLevel4: "双面魔帝"},
                            {id: 2222, name: "轮回夺舍", desc: "肉身损毁后，轮回夺舍，积累力量", detail: "你修噬魂夺舍诀后，在一次仙魔大战中肉身损毁，凭借夺舍之术轮回重生，多次夺舍天赋异禀之辈，积累无尽力量，最终突破桎梏，成为轮回魔帝，掌世间轮回夺舍之道，万劫不灭。", correspondingLevel4: "轮回魔帝"},
                            {id: 2223, name: "噬魂保命", desc: "不主动惹事，以噬魂之力保命修炼", detail: "你修噬魂夺舍诀后，心性谨慎，不主动招惹仙魔强者，仅在遭遇危险时吞噬神魂保命、默默修炼，最终成为保命魔尊，虽无滔天权势，却能在诸天纷争中安然无恙，万劫不死。", correspondingLevel4: "保命魔尊"}
                        ]},
                        {id: 223, name: "神魂炼魔诀", desc: "炼化神魂，炼就魔魂", detail: "神魂炼魔诀为噬魂流本源功法，将吞噬的神魂炼化，融入自身魔魂，炼就不灭魔魂，魔魂越强，肉身强度与修为也会同步提升，修至大成，魔魂可脱离肉身独立存在，是噬魂流中最根基深厚的功法。",
                        level5: [
                            {id: 2231, name: "炼就不灭魔魂", desc: "吞噬亿万神魂，炼就不灭魔魂", detail: "你修神魂炼魔诀大成后，耗时千年，吞噬亿万神魂，炼就真正的不灭魔魂，无惧任何神魂攻击，被魔族尊为魔魂皇，掌不灭魔魂之力，可随意穿梭诸天，不受肉身束缚。", correspondingLevel4: "魔魂皇"},
                            {id: 2232, name: "魔魂战仙魂", desc: "携不灭魔魂，与仙界仙魂大战", detail: "你修神魂炼魔诀至巅峰，携不灭魔魂，主动挑战仙界仙魂强者，历经千战不败，打破仙魂压制魔魂的桎梏，最终成为魔魂帝，掌世间魔魂法则，让魔魂不再受仙魂欺凌。", correspondingLevel4: "魔魂帝"},
                            {id: 2233, name: "守护魔魂", desc: "以不灭魔魂，守护魔族幼魂", detail: "你修神魂炼魔诀后，心生善念（魔之善念），以不灭魔魂守护魔族幼魂，抵御仙佛强者的迫害，成为魔族幼魂的守护神，被魔族后辈敬仰，最终成为护魂魔尊，掌世间护魂之道。", correspondingLevel4: "护魂魔尊"}
                        ]}
                    ],
                    炼魔流: [
                        {id: 231, name: "万魔归宗诀", desc: "号令万魔，归宗于我", detail: "万魔归宗诀为炼魔流第一秘术，可号令天下万魔，让万魔归宗于自身，融万魔之力于一体，修至大成，可化身为万魔之主，身具万魔特性，力量无穷，是炼魔流中最具统御力的功法。",
                        level5: [
                            {id: 2311, name: "统御万魔", desc: "号令诸天万魔，组建魔军", detail: "你修万魔归宗诀大成后，号令诸天万魔，组建起一支无敌魔军，踏平仙界边缘城池，统御天下魔族，被尊为万魔皇，掌万魔号令之力，万魔皆听你差遣。", correspondingLevel4: "万魔皇"},
                            {id: 2312, name: "万魔合一", desc: "融万魔之力于自身，化身为魔主", detail: "你修万魔归宗诀至巅峰，将收服的万魔之力全部融入自身，化身为真正的万魔之主，力量远超普通魔帝，可与仙界仙帝分庭抗礼，最终成为万魔帝，掌世间万魔法则，威慑诸天。", correspondingLevel4: "万魔帝"},
                            {id: 2313, name: "魔族共治", desc: "与各大魔尊重组魔族秩序，共治魔族", detail: "你修万魔归宗诀大成后，不恋独权，与各大魔尊重组魔族秩序，共治魔族，让魔族摆脱内乱，日益强盛，最终成为魔族共主，受所有魔族尊重，掌魔族秩序法则。", correspondingLevel4: "魔族共主"}
                        ]},
                        {id: 232, name: "混沌魔体诀", desc: "炼混沌魔体，融万魔之魂", detail: "混沌魔体诀为炼魔流最逆天的功法，以混沌之气为引，炼就混沌魔体，融万魔之魂于魔体之中，魔体强度与力量同步提升，修至大成，混沌魔体可硬抗仙帝一击，是炼魔流中最具爆发力的功法。",
                        level5: [
                            {id: 2321, name: "混沌魔体战仙帝", desc: "炼就混沌魔体，正面硬抗仙帝", detail: "你修混沌魔体诀大成后，炼就完美混沌魔体，孤身一人前往仙界，正面硬抗仙帝攻击，不落下风，一战成名，被魔族尊为混沌魔皇，掌混沌魔体之力，无人可挡。", correspondingLevel4: "混沌魔皇"},
                            {id: 2322, name: "吞噬混沌之气", desc: "前往混沌之地，吞噬混沌之气", detail: "你修混沌魔体诀后，为突破境界，前往混沌之地，吞噬无尽混沌之气，混沌魔体日益完善，最终突破至魔帝之境，成为混沌魔帝，掌世间混沌魔之道，与混沌共存。", correspondingLevel4: "混沌魔帝"},
                            {id: 2323, name: "守护混沌之门", desc: "驻守混沌之门，抵御外敌入侵", detail: "你修混沌魔体诀大成后，主动驻守混沌之门，抵御那些妄图抢夺混沌之气的仙魔强者，以身护道，最终成为混沌守门魔尊，掌混沌之门的开启与关闭，守护混沌之地的安宁。", correspondingLevel4: "混沌守门魔尊"}
                        ]},
                        {id: 233, name: "魔祖炼魔诀", desc: "承魔祖传承，炼魔之根本", detail: "魔祖炼魔诀为炼魔流本源功法，传自魔祖，炼魔之根本，不追求速成，层层打磨魔体与魔魂，修至大成，可继承魔祖部分力量，号令万魔，是炼魔流中最正统、最稳妥的功法。",
                        level5: [
                            {id: 2331, name: "继承魔祖之力", desc: "修至大成，继承魔祖部分力量", detail: "你修魔祖炼魔诀大成后，得到魔祖认可，继承魔祖部分力量，成为魔祖继承人，统御天下魔族，继续壮大魔族势力，最终成为魔祖帝，掌魔祖之道，受万魔敬仰。", correspondingLevel4: "魔祖帝"},
                            {id: 2332, name: "传承魔祖炼魔诀", desc: "广收弟子，传承魔祖炼魔诀", detail: "你修魔祖炼魔诀大成后，广收魔族弟子，挑选有资质、有道心之辈，传承魔祖炼魔诀，培育出无数炼魔强者，让魔祖之道得以延续，最终成为炼魔宗师，掌炼魔法则，统御天下炼魔修士。", correspondingLevel4: "炼魔宗师"},
                            {id: 2333, name: "隐居炼魔", desc: "隐于魔界深处，潜心修炼魔祖之道", detail: "你修魔祖炼魔诀后，不恋权柄，隐于魔界深处，潜心修炼魔祖之道，不问魔族纷争，最终修至魔帝之境，成为隐世魔尊，虽不掌权，却拥有撼动诸天的力量。", correspondingLevel4: "隐世魔尊"}
                        ]}
                    ]
                },
                level4: {}
            },
            星河令: {
                level2: [
                    {id: 31, name: "御星流", desc: "御使星辰，引星之力", detail: "御星流为星河令核心一脉，可御使诸天星辰，引星辰之力为自身所用，星辰之力越强，修为越高，修至大成，可御使星辰砸落，毁天灭地，是星河令中最具爆发力的修行方向。"},
                    {id: 32, name: "星算流", desc: "星象推演，预知祸福", detail: "星算流为星河令最神秘的一脉，通过观测星象，推演天道运势，预知祸福吉凶，甚至能逆天改命，修改他人运势，是星河令中最考验悟性与天赋的修行方向。"},
                    {id: 33, name: "星魂流", desc: "融星魂于自身，与星同存", detail: "星魂流为星河令最持久的一脉，将诸天星辰之魂融入自身神魂，与星辰同存，寿元绵长，星魂越强，神魂与肉身强度同步提升，修至大成，可与星辰共生，永世不灭，是星河令中最根基深厚的修行方向。"}
                ],
                level3: {
                    御星流: [
                        {id: 311, name: "星辰御天诀", desc: "御天星辰，执掌星权", detail: "星辰御天诀为御星流第一秘术，可御使诸天星辰，执掌星辰权柄，引星辰之力凝聚星刃、星盾，修至大成，可召唤星辰砸落，毁天灭地，是御星流中最具统御力的功法。",
                        level5: [
                            {id: 3111, name: "召唤星辰砸落", desc: "引诸天星辰之力，砸落仙界魔界", detail: "你修星辰御天诀大成后，可引诸天星辰之力，召唤星辰砸落，无论是仙界城池还是魔界领地，皆能一击摧毁，威慑诸天，被尊为星辰皇，掌星辰召唤之力，万仙万魔都要俯首。", correspondingLevel4: "星辰皇"},
                            {id: 3112, name: "执掌星权", desc: "执掌诸天星辰权柄，调节星象", detail: "你修星辰御天诀至巅峰，执掌诸天星辰权柄，可随意调节星象，修改星辰轨迹，维护天地星象秩序，最终成为星辰帝，掌世间星辰法则，统御诸天星辰。", correspondingLevel4: "星辰帝"},
                            {id: 3113, name: "御星游历", desc: "御使星辰，游历诸天万界", detail: "你修星辰御天诀大成后，不恋权柄，御使星辰，游历诸天万界，赏星辰美景，遇强则战，遇弱则护，最终成为御星仙尊，掌御星之道，逍遥天地之间。", correspondingLevel4: "御星仙尊"}
                        ]},
                        {id: 312, name: "星刃诛魔诀", desc: "凝聚星刃，诛仙杀魔", detail: "星刃诛魔诀为御星流最具杀伤力的功法，引星辰之力凝聚星刃，星刃锋利无比，可诛仙杀魔，一刀可斩断星辰，修至大成，可凝聚亿万星刃，形成星刃风暴，毁天灭地。",
                        level5: [
                            {id: 3121, name: "星刃风暴诛仙帝", desc: "凝聚亿万星刃，形成风暴斩杀仙帝", detail: "你修星刃诛魔诀大成后，凝聚亿万星刃，形成星刃风暴，孤身一人前往仙界，斩杀仙界仙帝，一战成名，被尊为星刃皇，掌星刃之力，无人可挡。", correspondingLevel4: "星刃皇"},
                            {id: 3122, name: "星刃护道", desc: "以星刃之力，守护星辰之道", detail: "你修星刃诛魔诀至巅峰，以星刃之力，守护星辰之道，抵御那些妄图破坏星辰秩序的仙魔强者，最终成为星刃帝，掌星刃法则，威慑诸天，守护星辰安宁。", correspondingLevel4: "星刃帝"},
                            {id: 3123, name: "传承星刃术", desc: "广收弟子，传承星刃诛魔诀", detail: "你修星刃诛魔诀大成后，广收弟子，挑选有天赋之辈，传承星刃诛魔诀，培育出无数御星强者，最终成为星刃宗师，掌星刃修炼之道，统御天下星刃修士。", correspondingLevel4: "星刃宗师"}
                        ]},
                        {id: 313, name: "星河护体诀", desc: "引星河之力，护体防身", detail: "星河护体诀为御星流最具防御性的功法，引星河之力形成护体星河，星河所至，万物不侵，可硬抗仙魔强者攻击，修至大成，护体星河可化为星河战甲，防御无双，是御星流中最稳妥的功法。",
                        level5: [
                            {id: 3131, name: "星河战甲护苍生", desc: "化星河战甲，守护一方苍生", detail: "你修星河护体诀大成后，化身为星河战甲，守护一方苍生，抵御仙魔纷争带来的灾祸，功德无量，被尊为星河皇，掌星河护体之力，守护苍生安宁。", correspondingLevel4: "星河皇"},
                            {id: 3132, name: "星河战甲战魔主", desc: "携星河战甲，正面硬抗魔主", detail: "你修星河护体诀至巅峰，星河战甲防御无双，正面硬抗魔界魔主攻击，不落下风，守护仙界安宁，最终成为星河帝，掌星河法则，统御天下星河之力。", correspondingLevel4: "星河帝"},
                            {id: 3133, name: "隐于星河", desc: "隐于星河之中，潜心修炼护体之道", detail: "你修星河护体诀后，不恋红尘纷争，隐于诸天星河之中，潜心修炼护体之道，最终修至仙尊之境，成为星河仙翁，与星河共存，永世不灭。", correspondingLevel4: "星河仙翁"}
                        ]}
                    ],
                    星算流: [
                        {id: 321, name: "星象推演诀", desc: "推演星象，预知祸福", detail: "星象推演诀为星算流本源功法，通过观测星象，推演天道运势，预知自身与他人的祸福吉凶，修至大成，可推演天地未来，甚至能预知仙帝、魔帝的陨落之日，是星算流中最正统的功法。",
                        level5: [
                            {id: 3211, name: "推演天地未来", desc: "推演天地未来走势，规避浩劫", detail: "你修星象推演诀大成后，可推演天地未来走势，预知诸天浩劫，提前布局，规避浩劫，守护天地安宁，功德无量，被尊为星算皇，掌星象推演之力，受万仙敬仰。", correspondingLevel4: "星算皇"},
                            {id: 3212, name: "预知仙帝陨落", desc: "推演仙帝陨落之日，辅佐新帝", detail: "你修星象推演诀至巅峰，可预知仙界仙帝的陨落之日，提前辅佐有仙缘之人，助其登基为帝，维护仙界秩序，最终成为星算帝，掌星算法则，统御天下星算修士。", correspondingLevel4: "星算帝"},
                            {id: 3213, name: "隐于星台", desc: "隐于星台，推演星象，不问世事", detail: "你修星象推演诀大成后，不恋权柄，隐于诸天星台之上，潜心推演星象，不问红尘纷争，虽不涉世事，却能提前预知浩劫，暗中守护天地，最终成为星算仙翁，永世推演星象。", correspondingLevel4: "星算仙翁"}
                        ]},
                        {id: 322, name: "逆天改命诀", desc: "修改星象，逆天改命", detail: "逆天改命诀为星算流最逆天的功法，可通过修改星象轨迹，逆天改命，修改自身或他人的运势，甚至能让将死之人起死回生，是星算流中最考验道心与机缘的功法。",
                        level5: [
                            {id: 3221, name: "为苍生改命", desc: "修改天地星象，为苍生逆天改命", detail: "你修逆天改命诀大成后，恰逢诸天浩劫将至，苍生流离失所，你不惜损耗自身修为，修改天地星象，为苍生逆天改命，规避浩劫，功德昭昭，被尊为改命皇，掌逆天改命之力，受万仙万魔敬仰。", correspondingLevel4: "改命皇"},
                            {id: 3222, name: "为自身改命", desc: "修改自身星象，突破境界桎梏", detail: "你修逆天改命诀后，自身遭遇境界桎梏，无法突破，你果断修改自身星象，逆天改命，突破桎梏，最终修至帝境，成为改命帝，掌改命法则，可随意修改他人运势。", correspondingLevel4: "改命帝"},
                            {id: 3223, name: "隐于暗处改命", desc: "隐于暗处，暗中修改有缘人运势", detail: "你修逆天改命诀后，不喜张扬，隐于诸天暗处，暗中修改那些心怀善意、有仙缘之人的运势，助其摆脱困境，成就仙途，最终成为隐世改命尊，掌暗处改命之道，无人知晓你的存在。", correspondingLevel4: "隐世改命尊"}
                        ]},
                        {id: 323, name: "星算御敌诀", desc: "推演敌人轨迹，御敌于千里之外", detail: "星算御敌诀为星算流最具实用性的功法，通过推演敌人的行动轨迹，提前布局，御敌于千里之外，无需近身搏斗，便可轻松击败敌人，修至大成，可推演敌人的弱点，一击致命，是星算流中最适合实战的功法。",
                        level5: [
                            {id: 3231, name: "推演魔主轨迹，一击致命", desc: "推演魔界魔主行动轨迹，一击致命", detail: "你修星算御敌诀大成后，推演魔界魔主的行动轨迹，找到其弱点，一击致命，斩杀魔主，守护仙界安宁，被尊为星算战皇，掌星算御敌之力，无人可挡。", correspondingLevel4: "星算战皇"},
                            {id: 3232, name: "推演仙魔大战轨迹，掌控战局", detail: "你修星算御敌诀至巅峰，推演仙魔大战的轨迹，提前布局，掌控战局，助仙界击败魔族，维护天地秩序，最终成为星算战帝，掌星算御敌法则，统御天下星算实战修士。", correspondingLevel4: "星算战帝"},
                            {id: 3233, name: "游历诸天，推演御敌", desc: "游历诸天万界，推演敌人轨迹，护佑有缘人", detail: "你修星算御敌诀大成后，游历诸天万界，遇到有缘人便推演其敌人轨迹，助其御敌，护佑其平安，最终成为星算仙尊，掌星算御敌之道，逍遥天地之间。", correspondingLevel4: "星算仙尊"}
                        ]}
                    ],
                    星魂流: [
                        {id: 331, name: "星辰融魂诀", desc: "融星辰之魂，炼就星魂", detail: "星辰融魂诀为星魂流第一秘术，将诸天星辰之魂融入自身神魂，炼就不灭星魂，星魂越强，神魂与肉身强度同步提升，修至大成，可与星辰共生，永世不灭，是星魂流中最霸道的功法。",
                        level5: [
                            {id: 3311, name: "融亿万星魂，炼就不灭星魂", desc: "融合亿万星辰之魂，炼就真正的不灭星魂", detail: "你修星辰融魂诀大成后，耗时万年，融合亿万星辰之魂，炼就真正的不灭星魂，无惧任何神魂攻击，可脱离肉身独立存在，被尊为星魂皇，掌星魂之力，统御诸天星魂。", correspondingLevel4: "星魂皇"},
                            {id: 3312, name: "与星辰共生，永世不灭", desc: "与诸天星辰共生，寿元无尽，永世不灭", detail: "你修星辰融魂诀至巅峰，与诸天星辰共生，星辰不灭，你便不灭，寿元无尽，最终修至帝境，成为星魂帝，掌星魂法则，统御天下星魂修士。", correspondingLevel4: "星魂帝"},
                            {id: 3313, name: "守护星辰之魂", desc: "以不灭星魂，守护诸天星辰之魂", detail: "你修星辰融魂诀大成后，主动守护诸天星辰之魂，抵御那些妄图吞噬星辰之魂的仙魔强者，成为星辰之魂的守护神，最终成为星魂尊，掌星辰之魂守护之道，与星辰共存。", correspondingLevel4: "星魂尊"}
                        ]},
                        {id: 332, name: "星魂分身诀", desc: "以星魂之力，凝聚分身", detail: "星魂分身诀为星魂流最具灵活性的功法，以星魂之力凝聚无数分身，每个分身都拥有自身一半的力量，可独立行动、修炼，修至大成，可凝聚亿万星魂分身，遍布诸天万界，是星魂流中最适合探查与实战的功法。",
                        level5: [
                            {id: 3321, name: "亿万星魂分身，遍布诸天", desc: "凝聚亿万星魂分身，遍布诸天万界，探查情报", detail: "你修星魂分身诀大成后，凝聚亿万星魂分身，遍布诸天万界，探查所有情报，掌控诸天动态，被尊为星魂分身皇，掌星魂分身之力，无人能逃脱你的探查。", correspondingLevel4: "星魂分身皇"},
                            {id: 3322, name: "星魂分身战诸天", desc: "以星魂分身，征战诸天万界", detail: "你修星魂分身诀至巅峰，以亿万星魂分身，征战诸天万界，击败所有敌人，统御诸天，最终成为星魂分身帝，掌星魂分身法则，威慑诸天万界。", correspondingLevel4: "星魂分身帝"},
                            {id: 3323, name: "星魂分身修炼", desc: "以星魂分身，同时修炼，快速提升", detail: "你修星魂分身诀后，以亿万星魂分身同时修炼，快速提升自身修为，无需耗费过多时间，最终修至仙尊之境，成为星魂分身仙翁，掌星魂分身修炼之道，逍遥天地。", correspondingLevel4: "星魂分身仙翁"}
                        ]},
                        {id: 333, name: "星魂疗伤诀", desc: "以星魂之力，疗伤续命", detail: "星魂疗伤诀为星魂流最具辅助性的功法，以星魂之力疗伤续命，可快速修复自身与他人的神魂、肉身损伤，甚至能让神魂受损之人快速恢复，修至大成，可活死人、肉白骨，是星魂流中最具功德的功法。",
                        level5: [
                            {id: 3331, name: "星魂疗伤救万仙", desc: "以星魂之力，救治万仙，修复神魂损伤", detail: "你修星魂疗伤诀大成后，在仙魔大战中，以星魂之力救治无数受伤的仙人，修复其神魂损伤，功德无量，被尊为星魂疗伤皇，掌星魂疗伤之力，受万仙敬仰。", correspondingLevel4: "星魂疗伤皇"},
                            {id: 3332, name: "星魂续命救苍生", desc: "以星魂之力，为苍生续命，摆脱劫难", detail: "你修星魂疗伤诀至巅峰，以星魂之力，为那些遭遇劫难、寿元将尽的苍生续命，摆脱劫难，泽被苍生，最终成为星魂续命帝，掌星魂续命法则，统御天下星魂疗伤修士。", correspondingLevel4: "星魂续命帝"},
                            {id: 3333, name: "开设星魂医馆", desc: "在仙界开设星魂医馆，救治神魂受损之人", detail: "你修星魂疗伤诀大成后，在仙界开设星魂医馆，不问身份，救治所有神魂受损之人，无论是仙是魔，只要心怀善意，皆可得到你的救治，最终成为星魂医尊，掌星魂医道法则。", correspondingLevel4: "星魂医尊"}
                        ]}
                    ]
                },
                level4: {}
            },
            大荒神陨录: {
                level2: [
                    {id: 41, name: "神兽流", desc: "召唤神兽，借兽之力", detail: "神兽流为大荒神陨录核心一脉，可召唤上古神兽，借神兽之力为自身所用，神兽越强，自身力量越强，修至大成，可召唤大荒诸神麾下神兽，统御神兽大军，是大荒神陨录中最具威慑力的修行方向。"},
                    {id: 42, name: "神血流", desc: "融合神血，炼就神体", detail: "神血流为大荒神陨录最霸道的一脉，融合上古诸神的神血，炼就无上神体，神血越纯，神体越强，修至大成，可拥有诸神之力，肉身不灭，是大荒神陨录中最考验机缘的修行方向。"},
                    {id: 43, name: "古法流", desc: "修炼古法，承神传承", detail: "古法流为大荒神陨录本源一脉，修炼上古诸神的古法秘术，承接诸神传承，修至大成，可继承诸神的部分权柄，号令大荒生灵，是大荒神陨录中最正统、最考验悟性的修行方向。"}
                ],
                level3: {
                    古法流: [
                        {id: 433, name: "大荒防御诀", desc: "修炼大荒防御古法，守护自身与他人", detail: "大荒防御诀为古法流最具防御性的功法，修炼上古大荒诸神传下的防御古法，以大荒灵气构筑防御屏障，屏障越厚，防御越强，修至大成，可构筑大荒守护屏障，抵御帝境强者的全力一击，是古法流中最核心的守护功法。",
                        level5: [
                            {id: 4331, name: "构筑大荒守护屏障，护佑万灵", desc: "大成后构筑大荒守护屏障，守护大荒所有生灵", detail: "你修大荒防御诀大成后，以自身修为构筑无边无际的大荒守护屏障，将整个上古大荒笼罩其中，抵御仙魔强者的入侵，护佑大荒万灵安宁，被尊为防御皇，掌大荒防御之道。", correspondingLevel4: "防御皇"},
                            {id: 4332, name: "防御屏障战帝境", desc: "以大荒防御屏障，硬抗帝境强者全力一击", detail: "你修大荒防御诀至巅峰，构筑的大荒防御屏障可硬抗仙帝、魔帝的全力一击，毫发无损，震惊诸天，最终成为防御帝，掌世间大荒防御法则，统御天下防御修士。", correspondingLevel4: "防御帝"},
                            {id: 4333, name: "传承防御古法，守护大荒传承", desc: "广收弟子，传承大荒防御古法，守护大荒修行传承", detail: "你修大荒防御诀大成后，广收有守护之心的弟子，传承大荒防御古法，让大荒的守护之道得以延续，最终成为防御尊，掌大荒防御传承，永世守护大荒之地。", correspondingLevel4: "防御尊"}
                        ]}
                    ]
                },
                level4: {}
            },
            长生诀: {
                level2: [
                    {id: 11, name: "养生流", desc: "固本培元，延年益寿", detail: "养生流为长生诀核心一脉，以固本培元为核心，缓慢打磨肉身与神魂，寿元随修为稳步提升，修至大成，可自然寿元无尽，是长生诀中最稳妥的一脉。"},
                    {id: 12, name: "延寿流", desc: "专修延寿之术，可增寿元千年", detail: "延寿流直接作用于寿元本源，修炼者每突破一层便可增寿千年，入门极易，然寿元过盛易遭天道嫉妒，引来专属的寿元天劫，天劫威力随寿元增加而暴涨。"},
                    {id: 13, name: "渡劫流", desc: "以渡劫炼体，借天罚提升修为", detail: "渡劫流反其道而行，主动引天劫炼体，天劫越强，肉身与修为提升越多，九死一生的修炼之路，十修九陨，然一旦成活，修为进展一日千里。"}
                ],
                level3: {
                    养生流: [
                        {id: 111, name: "九转固元功", desc: "九转锤炼肉身，固若金汤", detail: "九转固元功需历经九次肉身涅槃，每一次涅槃都需承受撕心裂肺之痛，涅槃后肉身脱胎换骨，第八次涅槃后距不死金身仅一步之遥，是固本流的至尊功法。",
                        level5: [
                            {id: 1111, name: "不死金身", desc: "肉身成圣，不死不灭", detail: "你完成九转固元，肉身化为不死金身，刀枪不入，水火不侵，即便是天罚也无法伤你分毫，最终肉身成圣，与天地同寿，成为长生仙尊。", correspondingLevel4: "长生仙尊"},
                            {id: 1112, name: "固元成痴", desc: "一味炼体，神魂跟不上肉身修为", detail: "你只知锤炼肉身，忽视了神魂的修炼，最终肉身达到圣境，神魂却停留在入门阶段，意识模糊，沦为只知炼体的痴儿，永世无法开启灵智。", correspondingLevel4: "固元痴圣"}
                        ]}
                    ]
                },
                level4: {}
            }
        };

        // 全局选择状态
        const selectState = {
            rootKey: '',    // 选中的根功法
            level2: '',     // 选中的level2流派
            level3: '',     // 选中的level3功法
            plotChoice: ''  // 选中的剧情选择
        };

        // 获取DOM节点
        const rootStep = document.getElementById('root-step');
        const level2Step = document.getElementById('level2-step');
        const level3Step = document.getElementById('level3-step');
        const level4Step = document.getElementById('level4-step');
        const level5Step = document.getElementById('level5-step');
        const plotChoiceStep = document.getElementById('plot-choice-step');
        const plotIntro = document.getElementById('plot-intro');
        const plotOptions = document.getElementById('plot-options');
        const jumpTip = document.getElementById('jump-tip');
        // 弹窗相关DOM
        const detailModal = document.getElementById('detailModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDetail = document.getElementById('modalDetail');
        const closeModal = document.querySelector('.close-modal');

        // 根功法选择事件（切换根功法剧情介绍）
        rootStep.addEventListener('click', (e) => {
            if (!e.target.classList.contains('option')) return;
            // 更新选择状态
            selectState.rootKey = e.target.dataset.key;
            // 标记选中样式
            rootStep.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
            e.target.classList.add('selected');
            // 更新根功法剧情介绍
            document.getElementById('root-intro').innerHTML = `<h4>${selectState.rootKey} - 功法背景</h4><p>${storyData[selectState.rootKey].intro || '上古至高功法，威力无穷，修行之路凶险万分'}</p>`;
            // 渲染level2
            renderLevel2();
        });

        // 渲染level2流派（添加流派剧情介绍）
        function renderLevel2() {
            const { rootKey } = selectState;
            const level2List = storyData[rootKey]?.level2 || [];
            if (level2List.length === 0) return;

            // 清空并渲染level2选项
            level2Step.innerHTML = `
                <h3>选择修行流派（${rootKey}）</h3>
                <div class="story-intro" id="level2-intro">
                    <h4>流派背景</h4>
                    <p>请选择具体的修行流派，不同流派将决定你的战斗方式与修行方向，仙魔殊途，慎选...</p>
                </div>
                <button class="back-btn" data-target="root">返回根功法选择</button>
            `;
            level2List.forEach(item => {
                const div = document.createElement('div');
                div.className = 'option';
                div.dataset.name = item.name;
                div.dataset.id = item.id;
                div.innerHTML = `${item.name} - ${item.desc}`;
                // 鼠标悬浮时更新剧情介绍
                div.addEventListener('mouseenter', () => {
                    document.getElementById('level2-intro').innerHTML = `<h4>${item.name} - 流派背景</h4><p>${item.detail || '该流派修行艰难，需历经万险方可有成'}</p>`;
                });
                level2Step.appendChild(div);
            });

            // 显示level2选择框
            level2Step.style.display = 'block';
        }

        // level2选择事件处理
        function handleLevel2Select(e) {
            if (!e.target.classList.contains('option')) return;
            // 更新选择状态
            selectState.level2 = e.target.dataset.name;
            // 标记选中样式
            level2Step.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
            e.target.classList.add('selected');
            // 渲染level3
            renderLevel3();
        }

        // 渲染level3功法（添加核心功法剧情介绍）
        function renderLevel3() {
            const { rootKey, level2 } = selectState;
            const level3List = storyData[rootKey]?.level3?.[level2] || [];
            if (level3List.length === 0) return;

            // 清空并渲染level3选项
            level3Step.innerHTML = `
                <h3>选择核心功法（${level2}）</h3>
                <div class="story-intro" id="level3-intro">
                    <h4>功法背景</h4>
                    <p>请选择核心功法，此功法将成为你一生的主修方向，决定你的核心战力与最终道途...</p>
                </div>
                <button class="back-btn" data-target="level2">返回流派选择</button>
            `;
            level3List.forEach(item => {
                const div = document.createElement('div');
                div.className = 'option';
                div.dataset.name = item.name;
                div.dataset.id = item.id;
                div.dataset.level4 = item.correspondingLevel4 || '';
                div.innerHTML = `${item.name} - ${item.desc}`;
                // 鼠标悬浮时更新剧情介绍
                div.addEventListener('mouseenter', () => {
                    document.getElementById('level3-intro').innerHTML = `<h4>${item.name} - 功法背景</h4><p>${item.detail || '此功法威力无穷，修行需付出巨大代价'}</p>`;
                });
                level3Step.appendChild(div);
            });

            // 显示level3选择框
            level3Step.style.display = 'block';
        }

        // level3选择事件处理 + 渲染level4境界
        function handleLevel3Select(e) {
            if (!e.target.classList.contains('option')) return;
            // 更新选择状态
            selectState.level3 = e.target.dataset.name;
            // 标记选中样式
            level3Step.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
            e.target.classList.add('selected');
            // 显示并渲染level4境界
            const level4Name = e.target.dataset.level4;
            level4Step.innerHTML = `
                <h3>当前绑定境界</h3>
                <div class="story-intro">
                    <h4>${level4Name || '无境界'} - 境界背景</h4>
                    <p>此境界为${selectState.level3}的专属境界，达到此境界后，你将掌握该功法的核心力量，开启最终的剧情抉择...</p>
                </div>
                <button class="back-btn" data-target="level3">返回核心功法选择</button>
                <div class="option selected">${level4Name || '无境界绑定'}</div>
            `;
            level4Step.style.display = 'block';
            // 渲染结局前剧情选择
            renderPlotChoice();
        }

        // 渲染结局前剧情选择
        function renderPlotChoice() {
            const { rootKey, level2, level3 } = selectState;
            // 找到当前选中的level3功法
            const level3List = storyData[rootKey]?.level3?.[level2] || [];
            const currentLevel3 = level3List.find(item => item.name === level3);
            const plotData = currentLevel3?.plotChoice || {
                intro: "你已修至功法大成，面临最终抉择，不同选择将决定你的最终归宿...",
                options: [
                    { id: 'plot1', name: "坚守正道，护佑苍生", targetEnd: currentLevel3?.level5?.[0]?.id || 0 },
                    { id: 'plot2', name: "追求极致力量，不惜一切代价", targetEnd: currentLevel3?.level5?.[1]?.id || 1 }
                ]
            };
            
            if (!plotData.options) return;

            // 更新剧情介绍
            plotIntro.innerHTML = `<h4>关键抉择背景</h4><p>${plotData.intro}</p>`;
            // 清空并渲染剧情选择项
            plotOptions.innerHTML = '';
            plotData.options.forEach(option => {
                const div = document.createElement('div');
                div.className = 'plot-option';
                div.dataset.targetEnd = option.targetEnd;
                div.innerHTML = option.name;
                plotOptions.appendChild(div);
            });

            // 显示剧情选择步骤
            plotChoiceStep.style.display = 'block';
            // 隐藏结局步骤（先选剧情再跳转）
            level5Step.style.display = 'none';
        }

        // 剧情选择事件（选择后自动跳转结局）
        function handlePlotChoice(e) {
            if (!e.target.classList.contains('plot-option')) return;
            // 记录选择的剧情
            selectState.plotChoice = e.target.dataset.targetEnd;
            // 显示跳转提示
            jumpTip.style.display = 'block';
            // 禁用所有剧情选项
            document.querySelectorAll('.plot-option').forEach(option => {
                option.style.pointerEvents = 'none';
                option.style.opacity = '0.5';
            });
            // 3秒后自动跳转到对应结局
            setTimeout(() => {
                renderLevel5(selectState.plotChoice);
                // 隐藏剧情选择步骤
                plotChoiceStep.style.display = 'none';
            }, 3000);
        }

        // 渲染level5最终结局（根据剧情选择自动定位对应结局）
        function renderLevel5(targetEndId) {
            const { rootKey, level2, level3 } = selectState;
            // 找到当前选中的level3功法
            const level3List = storyData[rootKey]?.level3?.[level2] || [];
            const currentLevel3 = level3List.find(item => item.name === level3);
            const level5List = currentLevel3?.level5 || [];
            
            // 清空并渲染level5选项
            level5Step.innerHTML = `
                <h3>最终结局（${level3}）</h3>
                <button class="back-btn" data-target="level4">返回境界查看</button>
            `;

            // 根据剧情选择定位对应结局
            let targetEnd = null;
            if (targetEndId) {
                targetEnd = level5List.find(item => item.id === parseInt(targetEndId));
                if (targetEnd) {
                    const div = document.createElement('div');
                    div.className = 'option selected';
                    div.dataset.id = targetEnd.id;
                    div.innerHTML = `<strong>${targetEnd.name}</strong><br/>${targetEnd.desc}<br/>详情：${targetEnd.detail.substring(0, 80)}...`;
                    level5Step.appendChild(div);
                    // 自动打开结局详情弹窗
                    openDetailModalByEnd(targetEnd);
                }
            } else {
                level5List.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'option';
                    div.dataset.id = item.id;
                    div.innerHTML = `<strong>${item.name}</strong><br/>${item.desc}<br/>详情：${item.detail.substring(0, 80)}...`;
                    level5Step.appendChild(div);
                });
            }

            // 显示level5选择框
            level5Step.style.display = 'block';
        }

        // 自动打开结局详情弹窗
        function openDetailModalByEnd(endData) {
            modalTitle.textContent = endData.name;
            modalDetail.textContent = endData.detail;
            detailModal.style.display = 'flex';
        }

        // 事件委托（统一处理所有点击事件）
        document.addEventListener('click', (e) => {
            // level2选择事件
            if (e.target.closest('#level2-step .option')) {
                handleLevel2Select(e);
            }
            // level3选择事件
            if (e.target.closest('#level3-step .option')) {
                handleLevel3Select(e);
            }
            // 回退按钮事件
            if (e.target.classList.contains('back-btn')) {
                handleBackBtn(e);
            }
            // 结局选项点击（打开弹窗）
            if (e.target.closest('#level5-step .option')) {
                openDetailModal(e);
            }
            // 剧情选择事件
            if (e.target.closest('.plot-option')) {
                handlePlotChoice(e);
            }
        });

        // 回退按钮处理函数
        function handleBackBtn(e) {
            const target = e.target.dataset.target;
            switch(target) {
                case 'root': 
                    selectState.level2 = '';
                    level2Step.style.display = 'none';
                    level3Step.style.display = 'none';
                    level4Step.style.display = 'none';
                    plotChoiceStep.style.display = 'none';
                    level5Step.style.display = 'none';
                    rootStep.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
                    // 恢复根功法初始剧情介绍
                    document.getElementById('root-intro').innerHTML = `<h4>剧情背景</h4><p>你本是青岚宗外门弟子，因偶得上古秘境传承，需从四大至高根功法中择一修行，此选择将决定你一生的修仙轨迹，仙魔两道，一念之间...</p>`;
                    break;
                case 'level2': 
                    selectState.level3 = '';
                    level3Step.style.display = 'none';
                    level4Step.style.display = 'none';
                    plotChoiceStep.style.display = 'none';
                    level5Step.style.display = 'none';
                    level2Step.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
                    break;
                case 'level3': 
                    level4Step.style.display = 'none';
                    plotChoiceStep.style.display = 'none';
                    level5Step.style.display = 'none';
                    level3Step.querySelectorAll('.option').forEach(item => item.classList.remove('selected'));
                    break;
                case 'level4': 
                    plotChoiceStep.style.display = 'none';
                    level5Step.style.display = 'none';
                    break;
            }
        }

        // 打开结局详情弹窗
        function openDetailModal(e) {
            const { rootKey, level2, level3 } = selectState;
            const level3List = storyData[rootKey]?.level3?.[level2] || [];
            const currentLevel3 = level3List.find(item => item.name === level3);
            const level5List = currentLevel3?.level5 || [];
            const currentLevel5 = level5List.find(item => item.id === parseInt(e.target.dataset.id));
            
            if (currentLevel5) {
                modalTitle.textContent = currentLevel5.name;
                modalDetail.textContent = currentLevel5.detail;
                detailModal.style.display = 'flex';
            }
        }

        // 关闭弹窗相关事件
        closeModal.addEventListener('click', () => {
            detailModal.style.display = 'none';
        });
        window.addEventListener('click', (e) => {
            if (e.target === detailModal) {
                detailModal.style.display = 'none';
            }
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && detailModal.style.display === 'flex') {
                detailModal.style.display = 'none';
            }
        });
    </script>
</body>
</html>
